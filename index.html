-- Enable UUID extension
create extension if not exists "uuid-ossp";

-- Drop old broken table if it exists
drop table if exists profiles;

-- Create fresh profiles table
create table profiles (
  id uuid primary key default uuid_generate_v4(),
  user_id uuid not null,
  full_name text,
  father_name text,
  whatsapp text,
  instagram text,
  facebook text,
  skills text,
  created_at timestamp default now()
);

-- Add foreign key to Supabase auth.users.id
alter table profiles
add constraint fk_user
foreign key (user_id) references auth.users (id) on delete cascade;

-- Ensure each user can only have one profile
create unique index profiles_user_id_idx on profiles(user_id);
